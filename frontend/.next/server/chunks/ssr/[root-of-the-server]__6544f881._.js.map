{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\r\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\r\n\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\r\nimport { SDK_CDN_URL } from \"./constants\";\r\n\r\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\r\n\r\nexport class RelayerSDKLoader {\r\n  private _trace?: TraceType;\r\n\r\n  constructor(options: { trace?: TraceType }) {\r\n    this._trace = options.trace;\r\n  }\r\n\r\n  public isLoaded() {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\r\n    }\r\n    return isFhevmWindowType(window, this._trace);\r\n  }\r\n\r\n  public load(): Promise<void> {\r\n    console.log(\"[RelayerSDKLoader] load...\");\r\n    // Ensure this only runs in the browser\r\n    if (typeof window === \"undefined\") {\r\n      console.log(\"[RelayerSDKLoader] window === undefined\");\r\n      return Promise.reject(\r\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\r\n      );\r\n    }\r\n\r\n    if (\"relayerSDK\" in window) {\r\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\r\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\r\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const existingScript = document.querySelector(\r\n        `script[src=\"${SDK_CDN_URL}\"]`\r\n      );\r\n      if (existingScript) {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          reject(\r\n            new Error(\r\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = SDK_CDN_URL;\r\n      script.type = \"text/javascript\";\r\n      script.async = true;\r\n\r\n      script.onload = () => {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\r\n          reject(\r\n            new Error(\r\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n      };\r\n\r\n      script.onerror = () => {\r\n        // Silently handle script load errors - they may be non-critical\r\n        console.warn(\"[RelayerSDKLoader] Script load failed, will retry if needed\");\r\n        reject(\r\n          new Error(\r\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\r\n          )\r\n        );\r\n      };\r\n\r\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\r\n      document.head.appendChild(script);\r\n      console.log(\"[RelayerSDKLoader] script added!\")\r\n    });\r\n  }\r\n}\r\n\r\nfunction isFhevmRelayerSDKType(\r\n  o: unknown,\r\n  trace?: TraceType\r\n): o is FhevmRelayerSDKType {\r\n  if (typeof o === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\r\n    return false;\r\n  }\r\n  if (o === null) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\r\n    return false;\r\n  }\r\n  if (typeof o !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\r\n    return false;\r\n  }\r\n  if (\"__initialized__\" in o) {\r\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\r\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isFhevmWindowType(\r\n  win: unknown,\r\n  trace?: TraceType\r\n): win is FhevmWindowType {\r\n  if (typeof win === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\r\n    return false;\r\n  }\r\n  if (win === null) {\r\n    trace?.(\"RelayerSDKLoader: window object is null\");\r\n    return false;\r\n  }\r\n  if (typeof win !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: window is not an object\");\r\n    return false;\r\n  }\r\n  if (!(\"relayerSDK\" in win)) {\r\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\r\n    return false;\r\n  }\r\n  return isFhevmRelayerSDKType(win.relayerSDK);\r\n}\r\n\r\nfunction objHasProperty<\r\n  T extends object,\r\n  K extends PropertyKey,\r\n  V extends string // \"string\", \"number\", etc.\r\n>(\r\n  obj: T,\r\n  propertyName: K,\r\n  propertyType: V,\r\n  trace?: TraceType\r\n): obj is T &\r\n  Record<\r\n    K,\r\n    V extends \"string\"\r\n      ? string\r\n      : V extends \"number\"\r\n      ? number\r\n      : V extends \"object\"\r\n      ? object\r\n      : V extends \"boolean\"\r\n      ? boolean\r\n      : V extends \"function\"\r\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (...args: any[]) => any\r\n      : unknown\r\n  > {\r\n  if (!obj || typeof obj !== \"object\") {\r\n    return false;\r\n  }\r\n\r\n  if (!(propertyName in obj)) {\r\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\r\n    return false;\r\n  }\r\n\r\n  const value = (obj as Record<K, unknown>)[propertyName];\r\n\r\n  if (value === null || value === undefined) {\r\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\r\n    return false;\r\n  }\r\n\r\n  if (typeof value !== propertyType) {\r\n    trace?.(\r\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AACA;;AAIO,MAAM;IACH,OAAmB;IAE3B,YAAY,OAA8B,CAAE;QAC1C,IAAI,CAAC,MAAM,GAAG,QAAQ,KAAK;IAC7B;IAEO,WAAW;QAChB,wCAAmC;YACjC,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,kBAAkB,QAAQ,IAAI,CAAC,MAAM;IAC9C;IAEO,OAAsB;QAC3B,QAAQ,GAAG,CAAC;QACZ,uCAAuC;QACvC,wCAAmC;YACjC,QAAQ,GAAG,CAAC;YACZ,OAAO,QAAQ,MAAM,CACnB,IAAI,MAAM;QAEd;;;IAyDF;AACF;AAEA,SAAS,sBACP,CAAU,EACV,KAAiB;IAEjB,IAAI,OAAO,MAAM,aAAa;QAC5B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,MAAM,MAAM;QACd,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,MAAM,UAAU;QACzB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,WAAW,YAAY,QAAQ;QACpD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,kBAAkB,YAAY,QAAQ;QAC3D,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,iBAAiB,UAAU,QAAQ;QACxD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,qBAAqB,GAAG;QAC1B,IAAI,EAAE,eAAe,KAAK,QAAQ,EAAE,eAAe,KAAK,OAAO;YAC7D,QAAQ;YACR,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEO,SAAS,kBACd,GAAY,EACZ,KAAiB;IAEjB,IAAI,OAAO,QAAQ,aAAa;QAC9B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,QAAQ,MAAM;QAChB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,QAAQ,UAAU;QAC3B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ;QACR,OAAO;IACT;IACA,OAAO,sBAAsB,IAAI,UAAU;AAC7C;AAEA,SAAS,eAKP,GAAM,EACN,YAAe,EACf,YAAe,EACf,KAAiB;IAiBjB,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU;QACnC,OAAO;IACT;IAEA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ,CAAC,0BAA0B,EAAE,OAAO,cAAc,CAAC,CAAC;QAC5D,OAAO;IACT;IAEA,MAAM,QAAQ,AAAC,GAA0B,CAAC,aAAa;IAEvD,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,QAAQ,CAAC,kBAAkB,EAAE,OAAO,cAAc,sBAAsB,CAAC;QACzE,OAAO;IACT;IAEA,IAAI,OAAO,UAAU,cAAc;QACjC,QACE,CAAC,kBAAkB,EAAE,OAAO,cAAc,UAAU,EAAE,aAAa,CAAC,CAAC;QAEvE,OAAO;IACT;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\ntype FhevmStoredPublicKey = {\r\n  publicKeyId: string;\r\n  publicKey: Uint8Array;\r\n};\r\n\r\ntype FhevmStoredPublicParams = {\r\n  publicParamsId: string;\r\n  publicParams: Uint8Array;\r\n};\r\n\r\ninterface PublicParamsDB extends DBSchema {\r\n  publicKeyStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicKey;\r\n    };\r\n  };\r\n  paramsStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicParams;\r\n    };\r\n  };\r\n}\r\n\r\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\r\n\r\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\r\n  if (__dbPromise) {\r\n    return __dbPromise;\r\n  }\r\n  if (typeof window === \"undefined\") {\r\n    return undefined;\r\n  }\r\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\r\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\r\n      }\r\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\r\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\r\n      }\r\n    },\r\n  });\r\n  return __dbPromise;\r\n}\r\n\r\ntype FhevmInstanceConfigPublicKey = {\r\n  data: Uint8Array | null;\r\n  id: string | null;\r\n};\r\n\r\ntype FhevmInstanceConfigPublicParams = {\r\n  \"2048\": {\r\n    publicParamsId: string;\r\n    publicParams: Uint8Array;\r\n  };\r\n};\r\n\r\nfunction assertFhevmStoredPublicKey(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicKey | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicKey must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicKeyId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\r\n  }\r\n  if (typeof value.publicKeyId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\r\n  }\r\n  if (!(\"publicKey\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\r\n  }\r\n  if (!(value.publicKey instanceof Uint8Array)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\r\n  }\r\n}\r\n\r\nfunction assertFhevmStoredPublicParams(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicParams | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicParams must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicParamsId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\r\n  }\r\n  if (typeof value.publicParamsId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\r\n  }\r\n  if (!(\"publicParams\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\r\n  }\r\n  if (!(value.publicParams instanceof Uint8Array)) {\r\n    throw new Error(\r\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\r\n  publicKey?: FhevmInstanceConfigPublicKey;\r\n  publicParams: FhevmInstanceConfigPublicParams | null;\r\n}> {\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return { publicParams: null };\r\n  }\r\n\r\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\r\n  try {\r\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\r\n    if (pk?.value) {\r\n      assertFhevmStoredPublicKey(pk.value);\r\n      storedPublicKey = pk.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\r\n  try {\r\n    const pp = await db.get(\"paramsStore\", aclAddress);\r\n    if (pp?.value) {\r\n      assertFhevmStoredPublicParams(pp.value);\r\n      storedPublicParams = pp.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  const publicKeyData = storedPublicKey?.publicKey;\r\n  const publicKeyId = storedPublicKey?.publicKeyId;\r\n  const publicParams = storedPublicParams\r\n    ? {\r\n        \"2048\": storedPublicParams,\r\n      }\r\n    : null;\r\n\r\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\r\n\r\n  if (publicKeyId && publicKeyData) {\r\n    publicKey = {\r\n      id: publicKeyId,\r\n      data: publicKeyData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...(publicKey !== undefined && { publicKey }),\r\n    publicParams,\r\n  };\r\n}\r\n\r\nexport async function publicKeyStorageSet(\r\n  aclAddress: `0x${string}`,\r\n  publicKey: FhevmStoredPublicKey | null,\r\n  publicParams: FhevmStoredPublicParams | null\r\n) {\r\n  assertFhevmStoredPublicKey(publicKey);\r\n  assertFhevmStoredPublicParams(publicParams);\r\n\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return;\r\n  }\r\n\r\n  if (publicKey) {\r\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\r\n  }\r\n\r\n  if (publicParams) {\r\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;;AA6BA,IAAI,cAAiE;AAErE,eAAe;IACb,IAAI,aAAa;QACf,OAAO;IACT;IACA,wCAAmC;QACjC,OAAO;IACT;;;AAYF;AAcA,SAAS,2BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,sCAAsC,CAAC;IAC1D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,iBAAiB,KAAK,GAAG;QAC7B,MAAM,IAAI,MAAM,CAAC,+CAA+C,CAAC;IACnE;IACA,IAAI,OAAO,MAAM,WAAW,KAAK,UAAU;QACzC,MAAM,IAAI,MAAM,CAAC,iDAAiD,CAAC;IACrE;IACA,IAAI,CAAC,CAAC,eAAe,KAAK,GAAG;QAC3B,MAAM,IAAI,MAAM,CAAC,6CAA6C,CAAC;IACjE;IACA,IAAI,CAAC,CAAC,MAAM,SAAS,YAAY,UAAU,GAAG;QAC5C,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;AACF;AAEA,SAAS,8BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,yCAAyC,CAAC;IAC7D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,GAAG;QAChC,MAAM,IAAI,MAAM,CAAC,qDAAqD,CAAC;IACzE;IACA,IAAI,OAAO,MAAM,cAAc,KAAK,UAAU;QAC5C,MAAM,IAAI,MAAM,CAAC,uDAAuD,CAAC;IAC3E;IACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,GAAG;QAC9B,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;IACA,IAAI,CAAC,CAAC,MAAM,YAAY,YAAY,UAAU,GAAG;QAC/C,MAAM,IAAI,MACR,CAAC,yDAAyD,CAAC;IAE/D;AACF;AAEO,eAAe,oBAAoB,UAAyB;IAIjE,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP,OAAO;YAAE,cAAc;QAAK;IAC9B;IAEA,IAAI,kBAA+C;IACnD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,kBAAkB;QAC1C,IAAI,IAAI,OAAO;YACb,2BAA2B,GAAG,KAAK;YACnC,kBAAkB,GAAG,KAAK;QAC5B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,IAAI,qBAAqD;IACzD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,eAAe;QACvC,IAAI,IAAI,OAAO;YACb,8BAA8B,GAAG,KAAK;YACtC,qBAAqB,GAAG,KAAK;QAC/B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,MAAM,gBAAgB,iBAAiB;IACvC,MAAM,cAAc,iBAAiB;IACrC,MAAM,eAAe,qBACjB;QACE,QAAQ;IACV,IACA;IAEJ,IAAI,YAAsD;IAE1D,IAAI,eAAe,eAAe;QAChC,YAAY;YACV,IAAI;YACJ,MAAM;QACR;IACF;IAEA,OAAO;QACL,GAAI,cAAc,aAAa;YAAE;QAAU,CAAC;QAC5C;IACF;AACF;AAEO,eAAe,oBACpB,UAAyB,EACzB,SAAsC,EACtC,YAA4C;IAE5C,2BAA2B;IAC3B,8BAA8B;IAE9B,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP;IACF;IAEA,IAAI,WAAW;QACb,MAAM,GAAG,GAAG,CAAC,kBAAkB;YAAE,KAAK;YAAY,OAAO;QAAU;IACrE;IAEA,IAAI,cAAc;QAChB,MAAM,GAAG,GAAG,CAAC,eAAe;YAAE,KAAK;YAAY,OAAO;QAAa;IACrE;AACF","debugId":null}},
    {"offset": {"line": 325, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\r\nimport type {\r\n  FhevmInitSDKOptions,\r\n  FhevmInitSDKType,\r\n  FhevmLoadSDKType,\r\n  FhevmWindowType,\r\n} from \"./fhevmTypes\";\r\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\r\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\r\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\r\n\r\nexport class FhevmReactError extends Error {\r\n  code: string;\r\n  constructor(code: string, message?: string, options?: ErrorOptions) {\r\n    super(message, options);\r\n    this.code = code;\r\n    this.name = \"FhevmReactError\";\r\n  }\r\n}\r\n\r\nfunction throwFhevmError(\r\n  code: string,\r\n  message?: string,\r\n  cause?: unknown\r\n): never {\r\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\r\n}\r\n\r\nconst isFhevmInitialized = (): boolean => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    return false;\r\n  }\r\n  return window.relayerSDK.__initialized__ === true;\r\n};\r\n\r\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\r\n  const loader = new RelayerSDKLoader({ trace: console.log });\r\n  return loader.load();\r\n};\r\n\r\nconst fhevmInitSDK: FhevmInitSDKType = async (\r\n  options?: FhevmInitSDKOptions\r\n) => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    throw new Error(\"window.relayerSDK is not available\");\r\n  }\r\n  const result = await window.relayerSDK.initSDK(options);\r\n  window.relayerSDK.__initialized__ = result;\r\n  if (!result) {\r\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\r\n  if (typeof a !== \"string\") {\r\n    return false;\r\n  }\r\n  if (!isAddress(a)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport class FhevmAbortError extends Error {\r\n  constructor(message = \"FHEVM operation was cancelled\") {\r\n    super(message);\r\n    this.name = \"FhevmAbortError\";\r\n  }\r\n}\r\n\r\ntype FhevmRelayerStatusType =\r\n  | \"sdk-loading\"\r\n  | \"sdk-loaded\"\r\n  | \"sdk-initializing\"\r\n  | \"sdk-initialized\"\r\n  | \"creating\";\r\n\r\nasync function getChainId(\r\n  providerOrUrl: Eip1193Provider | string\r\n): Promise<number> {\r\n  if (typeof providerOrUrl === \"string\") {\r\n    const provider = new JsonRpcProvider(providerOrUrl);\r\n    return Number((await provider.getNetwork()).chainId);\r\n  }\r\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\r\n  return Number.parseInt(chainId as string, 16);\r\n}\r\n\r\nasync function getWeb3Client(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"web3_clientVersion\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"WEB3_CLIENTVERSION_ERROR\",\r\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\r\n  | {\r\n      ACLAddress: `0x${string}`;\r\n      InputVerifierAddress: `0x${string}`;\r\n      KMSVerifierAddress: `0x${string}`;\r\n    }\r\n  | undefined\r\n> {\r\n  const version = await getWeb3Client(rpcUrl);\r\n  if (\r\n    typeof version !== \"string\" ||\r\n    !version.toLowerCase().includes(\"hardhat\")\r\n  ) {\r\n    // Not a Hardhat Node\r\n    return undefined;\r\n  }\r\n  try {\r\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\r\n    if (!metadata || typeof metadata !== \"object\") {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"ACLAddress\" in metadata &&\r\n        typeof metadata.ACLAddress === \"string\" &&\r\n        metadata.ACLAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"InputVerifierAddress\" in metadata &&\r\n        typeof metadata.InputVerifierAddress === \"string\" &&\r\n        metadata.InputVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"KMSVerifierAddress\" in metadata &&\r\n        typeof metadata.KMSVerifierAddress === \"string\" &&\r\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    return metadata;\r\n  } catch {\r\n    // Not a FHEVM Hardhat Node\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\r\n    return version;\r\n  } catch (e: any) {\r\n    // Silently handle fetch errors - they're non-critical if node isn't running\r\n    const errorMessage = String(e?.message || \"\");\r\n    if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"ECONNREFUSED\")) {\r\n      // Non-critical - node might not be running\r\n      throw new FhevmReactError(\r\n        \"FHEVM_RELAYER_METADATA_ERROR\",\r\n        `Cannot connect to ${rpcUrl}. Make sure Hardhat node is running.`\r\n      );\r\n    }\r\n    throwFhevmError(\r\n      \"FHEVM_RELAYER_METADATA_ERROR\",\r\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\r\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\r\ntype ResolveResult = MockResolveResult | GenericResolveResult;\r\n\r\nasync function resolve(\r\n  providerOrUrl: Eip1193Provider | string,\r\n  mockChains?: Record<number, string>\r\n): Promise<ResolveResult> {\r\n  // Resolve chainId\r\n  const chainId = await getChainId(providerOrUrl);\r\n\r\n  // Resolve rpc url\r\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n\r\n  const _mockChains: Record<number, string> = {\r\n    31337: \"http://localhost:8545\",\r\n    ...(mockChains ?? {}),\r\n  };\r\n\r\n  // Help Typescript solver here:\r\n  if (Object.hasOwn(_mockChains, chainId)) {\r\n    if (!rpcUrl) {\r\n      rpcUrl = _mockChains[chainId];\r\n    }\r\n\r\n    return { isMock: true, chainId, rpcUrl };\r\n  }\r\n\r\n  return { isMock: false, chainId, rpcUrl };\r\n}\r\n\r\nexport const createFhevmInstance = async (parameters: {\r\n  provider: Eip1193Provider | string;\r\n  mockChains?: Record<number, string>;\r\n  signal: AbortSignal;\r\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\r\n}): Promise<FhevmInstance> => {\r\n  const throwIfAborted = () => {\r\n    if (signal.aborted) throw new FhevmAbortError();\r\n  };\r\n\r\n  const notify = (status: FhevmRelayerStatusType) => {\r\n    if (onStatusChange) onStatusChange(status);\r\n  };\r\n\r\n  const {\r\n    signal,\r\n    onStatusChange,\r\n    provider: providerOrUrl,\r\n    mockChains,\r\n  } = parameters;\r\n\r\n  // Resolve chainId\r\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\r\n\r\n  if (isMock) {\r\n    // Throws an error if cannot connect or url does not refer to a Web3 client\r\n    const fhevmRelayerMetadata =\r\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\r\n\r\n    if (fhevmRelayerMetadata) {\r\n      // fhevmRelayerMetadata is defined, which means rpcUrl refers to a FHEVM Hardhat Node\r\n      notify(\"creating\");\r\n\r\n      //////////////////////////////////////////////////////////////////////////\r\n      // \r\n      // WARNING!!\r\n      // ALWAY USE DYNAMIC IMPORT TO AVOID INCLUDING THE ENTIRE FHEVM MOCK LIB \r\n      // IN THE FINAL PRODUCTION BUNDLE!!\r\n      // \r\n      //////////////////////////////////////////////////////////////////////////\r\n      const fhevmMock = await import(\"./mock/fhevmMock\");\r\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\r\n        rpcUrl,\r\n        chainId,\r\n        metadata: fhevmRelayerMetadata,\r\n      });\r\n\r\n      throwIfAborted();\r\n\r\n      return mockInstance;\r\n    }\r\n  }\r\n\r\n  throwIfAborted();\r\n\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    notify(\"sdk-loading\");\r\n\r\n    // throws an error if failed\r\n    await fhevmLoadSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-loaded\");\r\n  }\r\n\r\n  // notify that state === \"sdk-loaded\"\r\n\r\n  if (!isFhevmInitialized()) {\r\n    notify(\"sdk-initializing\");\r\n\r\n    // throws an error if failed\r\n    await fhevmInitSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-initialized\");\r\n  }\r\n\r\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\r\n\r\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\r\n  if (!checkIsAddress(aclAddress)) {\r\n    throw new Error(`Invalid address: ${aclAddress}`);\r\n  }\r\n\r\n  const pub = await publicKeyStorageGet(aclAddress);\r\n  throwIfAborted();\r\n\r\n  const config: FhevmInstanceConfig = {\r\n    ...relayerSDK.SepoliaConfig,\r\n    network: providerOrUrl,\r\n    publicKey: pub.publicKey,\r\n    publicParams: pub.publicParams,\r\n  };\r\n\r\n  // notify that state === \"creating\"\r\n  notify(\"creating\");\r\n\r\n  const instance = await relayerSDK.createInstance(config);\r\n\r\n  // Save the key even if aborted\r\n  await publicKeyStorageSet(\r\n    aclAddress,\r\n    instance.getPublicKey(),\r\n    instance.getPublicParams(2048)\r\n  );\r\n\r\n  throwIfAborted();\r\n\r\n  return instance;\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 555, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport type { FhevmInstance } from \"./fhevmTypes\";\r\nimport { createFhevmInstance } from \"./internal/fhevm\";\r\n\r\nfunction _assert(condition: boolean, message?: string): asserts condition {\r\n  if (!condition) {\r\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\r\n    console.error(m);\r\n    throw new Error(m);\r\n  }\r\n}\r\n\r\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\r\n\r\nexport function useFhevm(parameters: {\r\n  provider: string | ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  enabled?: boolean;\r\n  initialMockChains?: Readonly<Record<number, string>>;  \r\n}): {\r\n  instance: FhevmInstance | undefined;\r\n  refresh: () => void;\r\n  error: Error | undefined;\r\n  status: FhevmGoState;\r\n} {\r\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\r\n\r\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\r\n    undefined\r\n  );\r\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\r\n  const [error, _setError] = useState<Error | undefined>(undefined);\r\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\r\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\r\n  const _abortControllerRef = useRef<AbortController | null>(null);\r\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\r\n    provider\r\n  );\r\n  const _chainIdRef = useRef<number | undefined>(chainId);\r\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\r\n    initialMockChains\r\n  );\r\n\r\n  const refresh = useCallback(() => {\r\n    // Provider or chainId has changed. Abort immediately\r\n    if (_abortControllerRef.current) {\r\n      // Make sure _providerRef.current + _chainIdRef.current are undefined during abort\r\n      _providerRef.current = undefined;\r\n      _chainIdRef.current = undefined;\r\n\r\n      _abortControllerRef.current.abort();\r\n      _abortControllerRef.current = null;\r\n    }\r\n\r\n    _providerRef.current = provider;\r\n    _chainIdRef.current = chainId;\r\n\r\n    // Nullify instance immediately\r\n    _setInstance(undefined);\r\n    _setError(undefined);\r\n    _setStatus(\"idle\");\r\n\r\n    if (provider !== undefined) {\r\n      // Force call main useEffect\r\n      _setProviderChanged((prev) => prev + 1);\r\n    }\r\n\r\n    // Do not modify the running flag.\r\n  }, [provider, chainId]);\r\n\r\n  // Merge in main useEffect!!!\r\n  useEffect(() => {\r\n    refresh();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [provider, chainId]);\r\n\r\n  useEffect(() => {\r\n    _setIsRunning(enabled);\r\n  }, [enabled]);\r\n\r\n  // Main useEffect\r\n  useEffect(() => {\r\n    // is _providerRef.current valid here ?\r\n    // even if the first useEffect is rendered in the same render-cycle ?\r\n    if (_isRunning === false) {\r\n      // cancelled\r\n      console.log(\"cancelled\");\r\n      if (_abortControllerRef.current) {\r\n        _abortControllerRef.current.abort();\r\n        _abortControllerRef.current = null;\r\n      }\r\n      // May already be null if provider was changed in the previous render-cycle\r\n      _setInstance(undefined);\r\n      _setError(undefined);\r\n      _setStatus(\"idle\");\r\n      return;\r\n    }\r\n\r\n    if (_isRunning === true) {\r\n      if (_providerRef.current === undefined) {\r\n        // instance should be undefined\r\n        // this code below should be unecessary\r\n        _setInstance(undefined);\r\n        _setError(undefined);\r\n        _setStatus(\"idle\");\r\n        return;\r\n      }\r\n\r\n      if (!_abortControllerRef.current) {\r\n        _abortControllerRef.current = new AbortController();\r\n      }\r\n\r\n      _assert(\r\n        !_abortControllerRef.current.signal.aborted,\r\n        \"!controllerRef.current.signal.aborted\"\r\n      );\r\n\r\n      // Keep old instance\r\n      // Was set to undefined if provider changed\r\n      _setStatus(\"loading\");\r\n      _setError(undefined);\r\n\r\n      const thisSignal = _abortControllerRef.current.signal;\r\n      const thisProvider = _providerRef.current;\r\n      // Can be undefined, if so, call eth_chainId\r\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\r\n\r\n      createFhevmInstance({\r\n        signal: thisSignal,\r\n        provider: thisProvider,\r\n        mockChains: thisRpcUrlsByChainId,\r\n        onStatusChange: (s) =>\r\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\r\n      })\r\n        .then((i) => {\r\n          console.log(`[useFhevm] createFhevmInstance created!`);\r\n          //console.log(`completed (runId=${thisRunId})...`);\r\n          if (thisSignal.aborted) return;\r\n\r\n          // is there a edge case where the assert below would fail ?\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(i);\r\n          _setError(undefined);\r\n          _setStatus(\"ready\");\r\n        })\r\n        .catch((e) => {\r\n          // Silently handle non-critical errors (like fetch failures during initialization)\r\n          if (thisSignal.aborted) return;\r\n\r\n          // Filter out common non-critical errors\r\n          const errorMessage = e?.message || e?.toString() || \"\";\r\n          const isNonCriticalError = \r\n            errorMessage.includes(\"Failed to fetch\") ||\r\n            errorMessage.includes(\"NetworkError\") ||\r\n            errorMessage.includes(\"Load failed\");\r\n\r\n          if (isNonCriticalError) {\r\n            // Log but don't set as error - allow retry\r\n            console.warn(`[useFhevm] Non-critical error during initialization:`, e.name);\r\n            // Don't set error state for non-critical network issues\r\n            return;\r\n          }\r\n\r\n          console.log(`[useFhevm] Error during initialization:`, e.name);\r\n          \r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(undefined);\r\n          _setError(e);\r\n          _setStatus(\"error\");\r\n        });\r\n    }\r\n  }, [_isRunning, _providerChanged]);\r\n\r\n  return { instance, refresh, error, status };\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 706, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport {\r\n  EIP712Type,\r\n  FhevmDecryptionSignatureType,\r\n  FhevmInstance,\r\n} from \"./fhevmTypes\";\r\nimport { GenericStringStorage } from \"./GenericStringStorage\";\r\n\r\nfunction _timestampNow(): number {\r\n  return Math.floor(Date.now() / 1000);\r\n}\r\n\r\nclass FhevmDecryptionSignatureStorageKey {\r\n  #contractAddresses: `0x${string}`[];\r\n  #userAddress: `0x${string}`;\r\n  #publicKey: string | undefined;\r\n  #key: string;\r\n\r\n  constructor(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ) {\r\n    if (!ethers.isAddress(userAddress)) {\r\n      throw new TypeError(`Invalid address ${userAddress}`);\r\n    }\r\n\r\n    const sortedContractAddresses = (\r\n      contractAddresses as `0x${string}`[]\r\n    ).sort();\r\n\r\n    const emptyEIP712 = instance.createEIP712(\r\n      publicKey ?? ethers.ZeroAddress,\r\n      sortedContractAddresses,\r\n      0,\r\n      0\r\n    );\r\n\r\n    try {\r\n      const hash = ethers.TypedDataEncoder.hash(\r\n        emptyEIP712.domain,\r\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\r\n        emptyEIP712.message\r\n      );\r\n\r\n      this.#contractAddresses = sortedContractAddresses;\r\n      this.#userAddress = userAddress as `0x${string}`;\r\n\r\n      this.#key = `${userAddress}:${hash}`;\r\n    } catch (e) {\r\n      console.log(e);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  get contractAddresses(): `0x${string}`[] {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  get userAddress(): `0x${string}` {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  get publicKey(): string | undefined {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  get key(): string {\r\n    return this.#key;\r\n  }\r\n}\r\n\r\nexport class FhevmDecryptionSignature {\r\n  #publicKey: string;\r\n  #privateKey: string;\r\n  #signature: string;\r\n  #startTimestamp: number;\r\n  #durationDays: number;\r\n  #userAddress: `0x${string}`;\r\n  #contractAddresses: `0x${string}`[];\r\n  #eip712: EIP712Type;\r\n\r\n  private constructor(parameters: FhevmDecryptionSignatureType) {\r\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\r\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\r\n    }\r\n    this.#publicKey = parameters.publicKey;\r\n    this.#privateKey = parameters.privateKey;\r\n    this.#signature = parameters.signature;\r\n    this.#startTimestamp = parameters.startTimestamp;\r\n    this.#durationDays = parameters.durationDays;\r\n    this.#userAddress = parameters.userAddress;\r\n    this.#contractAddresses = parameters.contractAddresses;\r\n    this.#eip712 = parameters.eip712;\r\n  }\r\n\r\n  public get privateKey() {\r\n    return this.#privateKey;\r\n  }\r\n\r\n  public get publicKey() {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  public get signature() {\r\n    return this.#signature;\r\n  }\r\n\r\n  public get contractAddresses() {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  public get startTimestamp() {\r\n    return this.#startTimestamp;\r\n  }\r\n\r\n  public get durationDays() {\r\n    return this.#durationDays;\r\n  }\r\n\r\n  public get userAddress() {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\r\n    if (!s || typeof s !== \"object\") {\r\n      return false;\r\n    }\r\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\r\n      return false;\r\n    }\r\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\r\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\r\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"userAddress\" in s &&\r\n        typeof s.userAddress === \"string\" &&\r\n        s.userAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\r\n      return false;\r\n    }\r\n\r\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"message\" in s.eip712)) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"types\" in s.eip712 &&\r\n        typeof s.eip712.types === \"object\" &&\r\n        s.eip712.types !== null\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      publicKey: this.#publicKey,\r\n      privateKey: this.#privateKey,\r\n      signature: this.#signature,\r\n      startTimestamp: this.#startTimestamp,\r\n      durationDays: this.#durationDays,\r\n      userAddress: this.#userAddress,\r\n      contractAddresses: this.#contractAddresses,\r\n      eip712: this.#eip712,\r\n    };\r\n  }\r\n\r\n  static fromJSON(json: unknown) {\r\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\r\n    return new FhevmDecryptionSignature(data);\r\n  }\r\n\r\n  equals(s: FhevmDecryptionSignatureType) {\r\n    return s.signature === this.#signature;\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return (\r\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\r\n    );\r\n  }\r\n\r\n  async saveToGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    withPublicKey: boolean\r\n  ) {\r\n    try {\r\n      const value = JSON.stringify(this);\r\n\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        this.#contractAddresses,\r\n        this.#userAddress,\r\n        withPublicKey ? this.#publicKey : undefined\r\n      );\r\n      await storage.setItem(storageKey.key, value);\r\n      console.log(\r\n        `signature saved! contracts=${this.#contractAddresses.length}`\r\n      );\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\r\n      );\r\n    }\r\n  }\r\n\r\n  static async loadFromGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        publicKey\r\n      );\r\n\r\n      const result = await storage.getItem(storageKey.key);\r\n\r\n      if (!result) {\r\n        console.warn(`Could not load signature! key=${storageKey.key}`);\r\n        return null;\r\n      }\r\n\r\n      try {\r\n        const kps = FhevmDecryptionSignature.fromJSON(result);\r\n        if (!kps.isValid()) {\r\n          return null;\r\n        }\r\n\r\n        return kps;\r\n      } catch {\r\n        return null;\r\n      }\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\r\n      );\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async new(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    publicKey: string,\r\n    privateKey: string,\r\n    signer: ethers.Signer\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n      const startTimestamp = _timestampNow();\r\n      const durationDays = 365;\r\n      const eip712 = instance.createEIP712(\r\n        publicKey,\r\n        contractAddresses,\r\n        startTimestamp,\r\n        durationDays\r\n      );\r\n      const signature = await signer.signTypedData(\r\n        eip712.domain,\r\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\r\n        eip712.message\r\n      );\r\n      return new FhevmDecryptionSignature({\r\n        publicKey,\r\n        privateKey,\r\n        contractAddresses: contractAddresses as `0x${string}`[],\r\n        startTimestamp,\r\n        durationDays,\r\n        signature,\r\n        eip712: eip712 as EIP712Type,\r\n        userAddress,\r\n      });\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async loadOrSign(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    signer: ethers.Signer,\r\n    storage: GenericStringStorage,\r\n    keyPair?: { publicKey: string; privateKey: string }\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n\r\n    const cached: FhevmDecryptionSignature | null =\r\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\r\n        storage,\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        keyPair?.publicKey\r\n      );\r\n\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\r\n\r\n    const sig = await FhevmDecryptionSignature.new(\r\n      instance,\r\n      contractAddresses,\r\n      publicKey,\r\n      privateKey,\r\n      signer\r\n    );\r\n\r\n    if (!sig) {\r\n      return null;\r\n    }\r\n\r\n    await sig.saveToGenericStringStorage(\r\n      storage,\r\n      instance,\r\n      Boolean(keyPair?.publicKey)\r\n    );\r\n\r\n    return sig;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAQA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AACjC;AAEA,MAAM;IACJ,CAAA,iBAAkB,CAAkB;IACpC,CAAA,WAAY,CAAgB;IAC5B,CAAA,SAAU,CAAqB;IAC/B,CAAA,GAAI,CAAS;IAEb,YACE,QAAuB,EACvB,iBAA2B,EAC3B,WAAmB,EACnB,SAAkB,CAClB;QACA,IAAI,CAAC,sMAAM,CAAC,SAAS,CAAC,cAAc;YAClC,MAAM,IAAI,UAAU,CAAC,gBAAgB,EAAE,aAAa;QACtD;QAEA,MAAM,0BAA0B,AAC9B,kBACA,IAAI;QAEN,MAAM,cAAc,SAAS,YAAY,CACvC,aAAa,sMAAM,CAAC,WAAW,EAC/B,yBACA,GACA;QAGF,IAAI;YACF,MAAM,OAAO,sMAAM,CAAC,gBAAgB,CAAC,IAAI,CACvC,YAAY,MAAM,EAClB;gBAAE,gCAAgC,YAAY,KAAK,CAAC,8BAA8B;YAAC,GACnF,YAAY,OAAO;YAGrB,IAAI,CAAC,CAAA,iBAAkB,GAAG;YAC1B,IAAI,CAAC,CAAA,WAAY,GAAG;YAEpB,IAAI,CAAC,CAAA,GAAI,GAAG,GAAG,YAAY,CAAC,EAAE,MAAM;QACtC,EAAE,OAAO,GAAG;YACV,QAAQ,GAAG,CAAC;YACZ,MAAM;QACR;IACF;IAEA,IAAI,oBAAqC;QACvC,OAAO,IAAI,CAAC,CAAA,iBAAkB;IAChC;IAEA,IAAI,cAA6B;QAC/B,OAAO,IAAI,CAAC,CAAA,WAAY;IAC1B;IAEA,IAAI,YAAgC;QAClC,OAAO,IAAI,CAAC,CAAA,SAAU;IACxB;IAEA,IAAI,MAAc;QAChB,OAAO,IAAI,CAAC,CAAA,GAAI;IAClB;AACF;AAEO,MAAM;IACX,CAAA,SAAU,CAAS;IACnB,CAAA,UAAW,CAAS;IACpB,CAAA,SAAU,CAAS;IACnB,CAAA,cAAe,CAAS;IACxB,CAAA,YAAa,CAAS;IACtB,CAAA,WAAY,CAAgB;IAC5B,CAAA,iBAAkB,CAAkB;IACpC,CAAA,MAAO,CAAa;IAEpB,YAAoB,UAAwC,CAAE;QAC5D,IAAI,CAAC,yBAAyB,OAAO,CAAC,aAAa;YACjD,MAAM,IAAI,UAAU;QACtB;QACA,IAAI,CAAC,CAAA,SAAU,GAAG,WAAW,SAAS;QACtC,IAAI,CAAC,CAAA,UAAW,GAAG,WAAW,UAAU;QACxC,IAAI,CAAC,CAAA,SAAU,GAAG,WAAW,SAAS;QACtC,IAAI,CAAC,CAAA,cAAe,GAAG,WAAW,cAAc;QAChD,IAAI,CAAC,CAAA,YAAa,GAAG,WAAW,YAAY;QAC5C,IAAI,CAAC,CAAA,WAAY,GAAG,WAAW,WAAW;QAC1C,IAAI,CAAC,CAAA,iBAAkB,GAAG,WAAW,iBAAiB;QACtD,IAAI,CAAC,CAAA,MAAO,GAAG,WAAW,MAAM;IAClC;IAEA,IAAW,aAAa;QACtB,OAAO,IAAI,CAAC,CAAA,UAAW;IACzB;IAEA,IAAW,YAAY;QACrB,OAAO,IAAI,CAAC,CAAA,SAAU;IACxB;IAEA,IAAW,YAAY;QACrB,OAAO,IAAI,CAAC,CAAA,SAAU;IACxB;IAEA,IAAW,oBAAoB;QAC7B,OAAO,IAAI,CAAC,CAAA,iBAAkB;IAChC;IAEA,IAAW,iBAAiB;QAC1B,OAAO,IAAI,CAAC,CAAA,cAAe;IAC7B;IAEA,IAAW,eAAe;QACxB,OAAO,IAAI,CAAC,CAAA,YAAa;IAC3B;IAEA,IAAW,cAAc;QACvB,OAAO,IAAI,CAAC,CAAA,WAAY;IAC1B;IAEA,OAAO,QAAQ,CAAU,EAAqC;QAC5D,IAAI,CAAC,KAAK,OAAO,MAAM,UAAU;YAC/B,OAAO;QACT;QACA,IAAI,CAAC,CAAC,eAAe,KAAK,OAAO,EAAE,SAAS,KAAK,QAAQ,GAAG;YAC1D,OAAO;QACT;QACA,IAAI,CAAC,CAAC,gBAAgB,KAAK,OAAO,EAAE,UAAU,KAAK,QAAQ,GAAG;YAC5D,OAAO;QACT;QACA,IAAI,CAAC,CAAC,eAAe,KAAK,OAAO,EAAE,SAAS,KAAK,QAAQ,GAAG;YAC1D,OAAO;QACT;QACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,OAAO,EAAE,cAAc,KAAK,QAAQ,GAAG;YACpE,OAAO;QACT;QACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,OAAO,EAAE,YAAY,KAAK,QAAQ,GAAG;YAChE,OAAO;QACT;QACA,IAAI,CAAC,CAAC,uBAAuB,KAAK,MAAM,OAAO,CAAC,EAAE,iBAAiB,CAAC,GAAG;YACrE,OAAO;QACT;QACA,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,iBAAiB,CAAC,MAAM,EAAE,EAAE,EAAG;YACnD,IAAI,OAAO,EAAE,iBAAiB,CAAC,EAAE,KAAK,UAAU,OAAO;YACvD,IAAI,CAAC,EAAE,iBAAiB,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,OAAO;QACvD;QACA,IACE,CAAC,CACC,iBAAiB,KACjB,OAAO,EAAE,WAAW,KAAK,YACzB,EAAE,WAAW,CAAC,UAAU,CAAC,KAC3B,GACA;YACA,OAAO;QACT;QACA,IAAI,CAAC,CAAC,YAAY,KAAK,OAAO,EAAE,MAAM,KAAK,YAAY,EAAE,MAAM,KAAK,IAAI,GAAG;YACzE,OAAO;QACT;QAEA,IAAI,CAAC,CAAC,YAAY,EAAE,MAAM,IAAI,OAAO,EAAE,MAAM,CAAC,MAAM,KAAK,QAAQ,GAAG;YAClE,OAAO;QACT;QACA,IACE,CAAC,CAAC,iBAAiB,EAAE,MAAM,IAAI,OAAO,EAAE,MAAM,CAAC,WAAW,KAAK,QAAQ,GACvE;YACA,OAAO;QACT;QACA,IAAI,CAAC,CAAC,aAAa,EAAE,MAAM,GAAG;YAC5B,OAAO;QACT;QACA,IACE,CAAC,CACC,WAAW,EAAE,MAAM,IACnB,OAAO,EAAE,MAAM,CAAC,KAAK,KAAK,YAC1B,EAAE,MAAM,CAAC,KAAK,KAAK,IACrB,GACA;YACA,OAAO;QACT;QAEA,OAAO;IACT;IAEA,SAAS;QACP,OAAO;YACL,WAAW,IAAI,CAAC,CAAA,SAAU;YAC1B,YAAY,IAAI,CAAC,CAAA,UAAW;YAC5B,WAAW,IAAI,CAAC,CAAA,SAAU;YAC1B,gBAAgB,IAAI,CAAC,CAAA,cAAe;YACpC,cAAc,IAAI,CAAC,CAAA,YAAa;YAChC,aAAa,IAAI,CAAC,CAAA,WAAY;YAC9B,mBAAmB,IAAI,CAAC,CAAA,iBAAkB;YAC1C,QAAQ,IAAI,CAAC,CAAA,MAAO;QACtB;IACF;IAEA,OAAO,SAAS,IAAa,EAAE;QAC7B,MAAM,OAAO,OAAO,SAAS,WAAW,KAAK,KAAK,CAAC,QAAQ;QAC3D,OAAO,IAAI,yBAAyB;IACtC;IAEA,OAAO,CAA+B,EAAE;QACtC,OAAO,EAAE,SAAS,KAAK,IAAI,CAAC,CAAA,SAAU;IACxC;IAEA,UAAmB;QACjB,OACE,kBAAkB,IAAI,CAAC,CAAA,cAAe,GAAG,IAAI,CAAC,CAAA,YAAa,GAAG,KAAK,KAAK;IAE5E;IAEA,MAAM,2BACJ,OAA6B,EAC7B,QAAuB,EACvB,aAAsB,EACtB;QACA,IAAI;YACF,MAAM,QAAQ,KAAK,SAAS,CAAC,IAAI;YAEjC,MAAM,aAAa,IAAI,mCACrB,UACA,IAAI,CAAC,CAAA,iBAAkB,EACvB,IAAI,CAAC,CAAA,WAAY,EACjB,gBAAgB,IAAI,CAAC,CAAA,SAAU,GAAG;YAEpC,MAAM,QAAQ,OAAO,CAAC,WAAW,GAAG,EAAE;YACtC,QAAQ,GAAG,CACT,CAAC,2BAA2B,EAAE,IAAI,CAAC,CAAA,iBAAkB,CAAC,MAAM,EAAE;QAElE,EAAE,OAAM;YACN,QAAQ,KAAK,CACX,CAAC,6DAA6D,CAAC;QAEnE;IACF;IAEA,aAAa,6BACX,OAA6B,EAC7B,QAAuB,EACvB,iBAA2B,EAC3B,WAAmB,EACnB,SAAkB,EACwB;QAC1C,IAAI;YACF,MAAM,aAAa,IAAI,mCACrB,UACA,mBACA,aACA;YAGF,MAAM,SAAS,MAAM,QAAQ,OAAO,CAAC,WAAW,GAAG;YAEnD,IAAI,CAAC,QAAQ;gBACX,QAAQ,IAAI,CAAC,CAAC,8BAA8B,EAAE,WAAW,GAAG,EAAE;gBAC9D,OAAO;YACT;YAEA,IAAI;gBACF,MAAM,MAAM,yBAAyB,QAAQ,CAAC;gBAC9C,IAAI,CAAC,IAAI,OAAO,IAAI;oBAClB,OAAO;gBACT;gBAEA,OAAO;YACT,EAAE,OAAM;gBACN,OAAO;YACT;QACF,EAAE,OAAM;YACN,QAAQ,KAAK,CACX,CAAC,+DAA+D,CAAC;YAEnE,OAAO;QACT;IACF;IAEA,aAAa,IACX,QAAuB,EACvB,iBAA2B,EAC3B,SAAiB,EACjB,UAAkB,EAClB,MAAqB,EACqB;QAC1C,IAAI;YACF,MAAM,cAAe,MAAM,OAAO,UAAU;YAC5C,MAAM,iBAAiB;YACvB,MAAM,eAAe;YACrB,MAAM,SAAS,SAAS,YAAY,CAClC,WACA,mBACA,gBACA;YAEF,MAAM,YAAY,MAAM,OAAO,aAAa,CAC1C,OAAO,MAAM,EACb;gBAAE,gCAAgC,OAAO,KAAK,CAAC,8BAA8B;YAAC,GAC9E,OAAO,OAAO;YAEhB,OAAO,IAAI,yBAAyB;gBAClC;gBACA;gBACA,mBAAmB;gBACnB;gBACA;gBACA;gBACA,QAAQ;gBACR;YACF;QACF,EAAE,OAAM;YACN,OAAO;QACT;IACF;IAEA,aAAa,WACX,QAAuB,EACvB,iBAA2B,EAC3B,MAAqB,EACrB,OAA6B,EAC7B,OAAmD,EACT;QAC1C,MAAM,cAAe,MAAM,OAAO,UAAU;QAE5C,MAAM,SACJ,MAAM,yBAAyB,4BAA4B,CACzD,SACA,UACA,mBACA,aACA,SAAS;QAGb,IAAI,QAAQ;YACV,OAAO;QACT;QAEA,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,WAAW,SAAS,eAAe;QAErE,MAAM,MAAM,MAAM,yBAAyB,GAAG,CAC5C,UACA,mBACA,WACA,YACA;QAGF,IAAI,CAAC,KAAK;YACR,OAAO;QACT;QAEA,MAAM,IAAI,0BAA0B,CAClC,SACA,UACA,QAAQ,SAAS;QAGnB,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 936, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/abi/EnergyLogStorageAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EnergyLogStorageAddresses = { \n  \"11155111\": { address: \"0xaDa7b9535b9347490Bb09b70fE439f771F9a3b11\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0x5FbDB2315678afecb367f032d93F642f64180aa3\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,4BAA4B;IACvC,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 959, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/abi/EnergyLogStorageABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EnergyLogStorageABI = {\n  \"abi\": [\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"string\",\n          \"name\": \"date\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"externalEuint64\",\n          \"name\": \"electricity\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"externalEuint64\",\n          \"name\": \"gas\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"externalEuint64\",\n          \"name\": \"water\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"addEnergyLog\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"account\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"index\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getDate\",\n      \"outputs\": [\n        {\n          \"internalType\": \"string\",\n          \"name\": \"\",\n          \"type\": \"string\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"account\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"index\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getElectricity\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint64\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"account\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"index\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getGas\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint64\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"account\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"index\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getLog\",\n      \"outputs\": [\n        {\n          \"internalType\": \"string\",\n          \"name\": \"date\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"euint64\",\n          \"name\": \"electricity\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"euint64\",\n          \"name\": \"gas\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"euint64\",\n          \"name\": \"water\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"account\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getLogCount\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"account\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"index\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getWater\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint64\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,sBAAsB;IACjC,OAAO;QACL;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;KACD;AACH","debugId":null}},
    {"offset": {"line": 1174, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo18/pro18/frontend/components/EnergyLogDemo.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\r\nimport { useAccount, useChainId, useWalletClient, useSwitchChain } from \"wagmi\";\r\nimport { ConnectButton } from \"@rainbow-me/rainbowkit\";\r\nimport { ethers } from \"ethers\";\r\nimport { useFhevm } from \"../fhevm/useFhevm\";\r\nimport { useInMemoryStorage } from \"../hooks/useInMemoryStorage\";\r\nimport { FhevmDecryptionSignature } from \"../fhevm/FhevmDecryptionSignature\";\r\nimport { EnergyLogStorageAddresses } from \"../abi/EnergyLogStorageAddresses\";\r\nimport { EnergyLogStorageABI } from \"../abi/EnergyLogStorageABI\";\r\n\r\ntype EnergyLog = {\r\n  index: number;\r\n  date: string;\r\n  electricity?: string;\r\n  gas?: string;\r\n  water?: string;\r\n  encrypted: boolean;\r\n};\r\n\r\nexport const EnergyLogDemo = () => {\r\n  const { address, isConnected } = useAccount();\r\n  const chainId = useChainId();\r\n  const { data: walletClient } = useWalletClient();\r\n  const { switchChain } = useSwitchChain();\r\n  const { storage: fhevmDecryptionSignatureStorage } = useInMemoryStorage();\r\n\r\n  const [form, setForm] = useState({\r\n    date: new Date().toISOString().split(\"T\")[0],\r\n    electricity: \"\",\r\n    gas: \"\",\r\n    water: \"\",\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [logs, setLogs] = useState<EnergyLog[]>([]);\r\n  const [decryptingIndex, setDecryptingIndex] = useState<number | null>(null);\r\n\r\n  // Get contract info\r\n  const contractInfo = chainId\r\n    ? EnergyLogStorageAddresses[chainId.toString() as keyof typeof EnergyLogStorageAddresses]\r\n    : undefined;\r\n\r\n  const contractAddress = contractInfo?.address;\r\n  const isDeployed = contractAddress && contractAddress !== ethers.ZeroAddress;\r\n\r\n  // Get provider for FHEVM - use walletClient directly (Eip1193Provider) or fallback to RPC URL string\r\n  const fhevmProvider = useMemo(() => {\r\n    if (walletClient) {\r\n      // walletClient from wagmi is already an Eip1193Provider, use it directly\r\n      return walletClient as any;\r\n    }\r\n    // Fallback to RPC URL string for localhost\r\n    if (chainId === 31337) {\r\n      return \"http://localhost:8545\";\r\n    }\r\n    return undefined;\r\n  }, [walletClient, chainId]);\r\n\r\n  // Regular provider for ethers operations\r\n  const provider = useMemo(() => {\r\n    if (walletClient) {\r\n      return new ethers.BrowserProvider(walletClient as any);\r\n    }\r\n    // Fallback to RPC for localhost\r\n    if (chainId === 31337) {\r\n      return new ethers.JsonRpcProvider(\"http://localhost:8545\");\r\n    }\r\n    return undefined;\r\n  }, [walletClient, chainId]);\r\n\r\n  // FHEVM instance\r\n  const {\r\n    instance: fhevmInstance,\r\n    status: fhevmStatus,\r\n    error: fhevmError,\r\n  } = useFhevm({\r\n    provider: fhevmProvider,\r\n    chainId: chainId || undefined,\r\n    enabled: isConnected && !!contractAddress && !!walletClient,\r\n    initialMockChains: { 31337: \"http://localhost:8545\" },\r\n  });\r\n\r\n  // Load logs\r\n  const loadLogs = useCallback(async () => {\r\n    if (!isConnected || !address || !contractAddress || !walletClient) return;\r\n\r\n    try {\r\n      const signer = await new ethers.BrowserProvider(walletClient as any).getSigner();\r\n      const contract = new ethers.Contract(\r\n        contractAddress,\r\n        EnergyLogStorageABI.abi as any,\r\n        signer\r\n      );\r\n\r\n      // Check if contract has data for this address\r\n      let logCount: bigint;\r\n      try {\r\n        logCount = await contract.getLogCount(address);\r\n      } catch (e: any) {\r\n        // If contract returns empty or error, user has no logs yet\r\n        console.log(\"No logs found or contract not initialized:\", e.message);\r\n        setLogs([]);\r\n        return;\r\n      }\r\n\r\n      const count = Number(logCount);\r\n      if (count === 0) {\r\n        setLogs([]);\r\n        return;\r\n      }\r\n\r\n      const newLogs: EnergyLog[] = [];\r\n      for (let i = 0; i < count; i++) {\r\n        try {\r\n          const date = await contract.getDate(address, i);\r\n          newLogs.push({\r\n            index: i,\r\n            date,\r\n            encrypted: true,\r\n          });\r\n        } catch (e: any) {\r\n          console.error(`Failed to get log ${i}:`, e);\r\n        }\r\n      }\r\n\r\n      setLogs(newLogs);\r\n    } catch (e: any) {\r\n      // Silently handle non-critical errors\r\n      const errorMessage = e?.message || e?.toString() || \"\";\r\n      const isNonCriticalError = \r\n        errorMessage.includes(\"Failed to fetch\") ||\r\n        errorMessage.includes(\"could not decode result data\") ||\r\n        errorMessage.includes(\"NetworkError\");\r\n\r\n      if (!isNonCriticalError) {\r\n        console.error(\"Failed to load logs:\", e);\r\n        setMessage(`Failed to load logs: ${e.message}`);\r\n      } else {\r\n        // Silently handle - likely just empty contract or network issue\r\n        console.log(\"No logs available or network issue (non-critical)\");\r\n      }\r\n      setLogs([]);\r\n    }\r\n  }, [isConnected, address, contractAddress, walletClient]);\r\n\r\n  useEffect(() => {\r\n    if (isConnected && address && contractAddress && walletClient) {\r\n      loadLogs();\r\n    } else {\r\n      setLogs([]);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [isConnected, address, contractAddress, walletClient]);\r\n\r\n  // Add energy log\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!isConnected || !walletClient || !contractAddress || !fhevmInstance) {\r\n      setMessage(\"Please connect wallet and ensure contract is deployed\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setMessage(\"\");\r\n\r\n    try {\r\n      const signer = await new ethers.BrowserProvider(walletClient as any).getSigner();\r\n      const userAddress = await signer.getAddress();\r\n\r\n      // Encrypt values\r\n      const electricity = BigInt(form.electricity);\r\n      const gas = BigInt(form.gas);\r\n      const water = BigInt(form.water);\r\n\r\n      const encryptedInput = fhevmInstance\r\n        .createEncryptedInput(contractAddress, userAddress)\r\n        .add64(electricity)\r\n        .add64(gas)\r\n        .add64(water);\r\n\r\n      let encrypted;\r\n      try {\r\n        setMessage(\"Encrypting data...\");\r\n        encrypted = await encryptedInput.encrypt();\r\n      } catch (encryptError: any) {\r\n        console.error(\"Encryption error:\", encryptError);\r\n        const errorMessage = encryptError?.message || String(encryptError || \"\");\r\n        \r\n        // Handle relayer-specific errors\r\n        if (errorMessage.includes(\"Relayer\") || errorMessage.includes(\"Bad JSON\") || errorMessage.includes(\"relayer\")) {\r\n          setMessage(\r\n            \"FHEVM Relayer service error. This may be due to: (1) Network connectivity issues, (2) Relayer service temporarily unavailable, (3) Please try again in a few moments. If the problem persists, check your network connection or try switching networks.\"\r\n          );\r\n          return;\r\n        }\r\n        \r\n        throw encryptError;\r\n      }\r\n\r\n      // Call contract\r\n      const contract = new ethers.Contract(\r\n        contractAddress,\r\n        EnergyLogStorageABI.abi as any,\r\n        signer\r\n      );\r\n\r\n      setMessage(\"Submitting transaction...\");\r\n      const tx = await contract.addEnergyLog(\r\n        form.date,\r\n        encrypted.handles[0],\r\n        encrypted.handles[1],\r\n        encrypted.handles[2],\r\n        encrypted.inputProof\r\n      );\r\n\r\n      setMessage(`Transaction submitted: ${tx.hash}`);\r\n      await tx.wait();\r\n      setMessage(\"Energy log added successfully!\");\r\n\r\n      // Reset form\r\n      setForm({\r\n        date: new Date().toISOString().split(\"T\")[0],\r\n        electricity: \"\",\r\n        gas: \"\",\r\n        water: \"\",\r\n      });\r\n\r\n      // Reload logs\r\n      await loadLogs();\r\n    } catch (e: any) {\r\n      console.error(\"Failed to add log:\", e);\r\n      const errorMessage = e?.message || String(e || \"\");\r\n      \r\n      // Provide more helpful error messages\r\n      if (errorMessage.includes(\"Relayer\") || errorMessage.includes(\"Bad JSON\") || errorMessage.includes(\"relayer\")) {\r\n        setMessage(\r\n          \"FHEVM Relayer service error. Please: (1) Check your internet connection, (2) Wait a moment and try again, (3) Ensure you're on the correct network (Sepolia or Hardhat Local)\"\r\n        );\r\n      } else if (errorMessage.includes(\"user rejected\") || errorMessage.includes(\"denied\")) {\r\n        setMessage(\"Transaction rejected by user\");\r\n      } else if (errorMessage.includes(\"insufficient funds\")) {\r\n        setMessage(\"Insufficient funds for transaction\");\r\n      } else {\r\n        setMessage(`Failed: ${errorMessage}`);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Decrypt log\r\n  const decryptLog = async (index: number) => {\r\n    if (!isConnected || !walletClient || !contractAddress || !fhevmInstance || !address) {\r\n      setMessage(\"Please connect wallet\");\r\n      return;\r\n    }\r\n\r\n    setDecryptingIndex(index);\r\n    setMessage(\"\");\r\n\r\n    try {\r\n      const signer = await new ethers.BrowserProvider(walletClient as any).getSigner();\r\n      const provider = new ethers.BrowserProvider(walletClient as any);\r\n\r\n      const contract = new ethers.Contract(\r\n        contractAddress,\r\n        EnergyLogStorageABI.abi as any,\r\n        provider\r\n      );\r\n\r\n      // Get encrypted handles\r\n      const [electricityHandle, gasHandle, waterHandle] = await Promise.all([\r\n        contract.getElectricity(address, index),\r\n        contract.getGas(address, index),\r\n        contract.getWater(address, index),\r\n      ]);\r\n\r\n      const zero = ethers.ZeroHash;\r\n      const handles = [\r\n        { handle: electricityHandle, contractAddress },\r\n        { handle: gasHandle, contractAddress },\r\n        { handle: waterHandle, contractAddress },\r\n      ].filter((h) => h.handle !== zero);\r\n\r\n      if (handles.length === 0) {\r\n        setMessage(\"No encrypted data found\");\r\n        return;\r\n      }\r\n\r\n      // Get decryption signature\r\n      const sig = await FhevmDecryptionSignature.loadOrSign(\r\n        fhevmInstance,\r\n        [contractAddress],\r\n        signer,\r\n        fhevmDecryptionSignatureStorage\r\n      );\r\n\r\n      if (!sig) {\r\n        setMessage(\"Failed to create decryption signature\");\r\n        return;\r\n      }\r\n\r\n      // Decrypt\r\n      const results = await fhevmInstance.userDecrypt(\r\n        handles.map((h) => ({\r\n          handle: h.handle,\r\n          contractAddress: h.contractAddress as `0x${string}`,\r\n        })),\r\n        sig.privateKey,\r\n        sig.publicKey,\r\n        sig.signature,\r\n        sig.contractAddresses,\r\n        sig.userAddress,\r\n        sig.startTimestamp.toString(),\r\n        sig.durationDays.toString()\r\n      );\r\n\r\n      // Update log with decrypted values\r\n      setLogs((prev) =>\r\n        prev.map((log) =>\r\n          log.index === index\r\n            ? {\r\n                ...log,\r\n                electricity: results[electricityHandle]?.toString() || undefined,\r\n                gas: results[gasHandle]?.toString() || undefined,\r\n                water: results[waterHandle]?.toString() || undefined,\r\n                encrypted: false,\r\n              }\r\n            : log\r\n        )\r\n      );\r\n\r\n      setMessage(\"Log decrypted successfully!\");\r\n    } catch (e: any) {\r\n      const errorMessage = e?.message || e?.toString() || \"\";\r\n      // Suppress non-critical fetch errors\r\n      if (!errorMessage.includes(\"Failed to fetch\") && !errorMessage.includes(\"NetworkError\")) {\r\n        console.error(\"Failed to decrypt:\", e);\r\n        setMessage(`Failed to decrypt: ${errorMessage}`);\r\n      } else {\r\n        // Network errors - show user-friendly message\r\n        setMessage(\"Network issue during decryption. Please try again.\");\r\n      }\r\n    } finally {\r\n      setDecryptingIndex(null);\r\n    }\r\n  };\r\n\r\n  if (!isConnected) {\r\n    return (\r\n      <div className=\"mx-auto mt-20\">\r\n        <div className=\"bg-white rounded-xl p-8 shadow-lg border-2 border-purple-200\">\r\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4 text-center\">\r\n            Connect Your Wallet\r\n          </h2>\r\n          <p className=\"text-gray-600 mb-6 text-center\">\r\n            Connect your Rainbow wallet to start managing your encrypted energy logs\r\n          </p>\r\n          <div className=\"flex justify-center\">\r\n            <ConnectButton />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Switch to localhost network\r\n  const switchToLocalhost = async () => {\r\n    if (!walletClient) {\r\n      setMessage(\"Please connect your wallet first\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Try to switch to localhost network\r\n      await switchChain({ chainId: 31337 });\r\n      setMessage(\"Switched to Hardhat Local network successfully!\");\r\n    } catch (error: any) {\r\n      console.error(\"Failed to switch chain:\", error);\r\n      \r\n      // If chain doesn't exist (error code 4902), try to add it\r\n      if (error?.code === 4902 || error?.message?.includes(\"not added\") || error?.message?.includes(\"Unrecognized chain\")) {\r\n        try {\r\n          // Use wallet's request method to add chain\r\n          const provider = new ethers.BrowserProvider(walletClient as any);\r\n          const signer = await provider.getSigner();\r\n          const providerEip1193 = signer.provider as any;\r\n          \r\n          await providerEip1193.request({\r\n            method: \"wallet_addEthereumChain\",\r\n            params: [\r\n              {\r\n                chainId: \"0x7A69\", // 31337 in hex\r\n                chainName: \"Hardhat Local\",\r\n                nativeCurrency: {\r\n                  name: \"Ether\",\r\n                  symbol: \"ETH\",\r\n                  decimals: 18,\r\n                },\r\n                rpcUrls: [\"http://localhost:8545\"],\r\n                blockExplorerUrls: [],\r\n              },\r\n            ],\r\n          });\r\n          \r\n          // Try switching again after adding\r\n          await switchChain({ chainId: 31337 });\r\n          setMessage(\"Added and switched to Hardhat Local network!\");\r\n        } catch (addError: any) {\r\n          console.error(\"Failed to add chain:\", addError);\r\n          setMessage(\"Failed to add network automatically. Please add Hardhat Local network manually in your wallet (RPC: http://localhost:8545, Chain ID: 31337).\");\r\n        }\r\n      } else {\r\n        setMessage(`Failed to switch network: ${error?.message || \"Unknown error\"}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!isDeployed) {\r\n    const isSepolia = chainId === 11155111;\r\n    const isLocalhost = chainId === 31337;\r\n    \r\n    return (\r\n      <div className=\"mx-auto mt-20 max-w-2xl\">\r\n        <div className=\"bg-white rounded-xl p-8 shadow-lg border-2 border-red-200\">\r\n          <h2 className=\"text-2xl font-bold text-red-600 mb-4\">\r\n            Contract Not Deployed\r\n          </h2>\r\n          {isSepolia ? (\r\n            <>\r\n              <p className=\"text-gray-600 mb-4\">\r\n                EnergyLogStorage contract is not deployed on Sepolia (chain {chainId}).\r\n              </p>\r\n              <p className=\"text-gray-800 font-semibold mb-4 text-lg\">\r\n                 Please switch to Hardhat Local network (Chain ID: 31337).\r\n              </p>\r\n              \r\n              {/* Switch Network Button */}\r\n              <div className=\"mb-4\">\r\n                <button\r\n                  onClick={switchToLocalhost}\r\n                  className=\"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all duration-200 shadow-lg\"\r\n                >\r\n                   Switch to Hardhat Local Network\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4\">\r\n                <p className=\"text-blue-800 font-semibold mb-2\">Or add network manually:</p>\r\n                <ol className=\"list-decimal list-inside text-blue-700 space-y-1 text-sm\">\r\n                  <li>Click on the network selector in your wallet (top right)</li>\r\n                  <li>Add network manually:</li>\r\n                  <li className=\"ml-6\">- Network Name: Hardhat Local</li>\r\n                  <li className=\"ml-6\">- RPC URL: http://localhost:8545</li>\r\n                  <li className=\"ml-6\">- Chain ID: 31337</li>\r\n                  <li className=\"ml-6\">- Currency Symbol: ETH</li>\r\n                </ol>\r\n              </div>\r\n              <p className=\"text-gray-600 text-sm\">\r\n                Or deploy the contract to Sepolia: <code className=\"bg-gray-100 px-2 py-1 rounded text-xs\">npx hardhat deploy --network sepolia</code>\r\n              </p>\r\n            </>\r\n          ) : isLocalhost ? (\r\n            <>\r\n              <p className=\"text-gray-600 mb-2\">\r\n                EnergyLogStorage contract is not deployed on Hardhat Local (chain {chainId}).\r\n              </p>\r\n              <p className=\"text-gray-600 mb-2\">\r\n                Please deploy it first:\r\n              </p>\r\n              <div className=\"bg-gray-100 rounded p-3 mb-2\">\r\n                <code className=\"text-sm\">npx hardhat deploy --network localhost</code>\r\n              </div>\r\n              <p className=\"text-gray-500 text-sm\">\r\n                Make sure Hardhat node is running: <code className=\"bg-gray-100 px-2 py-1 rounded text-xs\">npx hardhat node</code>\r\n              </p>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <p className=\"text-gray-600 mb-4\">\r\n                EnergyLogStorage contract is not deployed on chain {chainId}.\r\n              </p>\r\n              <button\r\n                onClick={switchToLocalhost}\r\n                className=\"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all duration-200 shadow-lg mb-4\"\r\n              >\r\n                 Switch to Hardhat Local Network\r\n              </button>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full max-w-6xl mx-auto space-y-6\">\r\n      {/* Header with Connect Button and Network Switch */}\r\n      <div className=\"flex justify-between items-center bg-white rounded-xl p-4 shadow-lg border-2 border-purple-200\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <h1 className=\"text-3xl font-bold text-gray-800\">Energy Log Manager</h1>\r\n          {isConnected && (\r\n            <div className=\"text-sm text-gray-600\">\r\n              <span className=\"font-semibold\">Network:</span>{\" \"}\r\n              {chainId === 31337 ? (\r\n                <span className=\"text-green-600 font-semibold\">Hardhat Local</span>\r\n              ) : chainId === 11155111 ? (\r\n                <span className=\"text-orange-600 font-semibold\">Sepolia</span>\r\n              ) : (\r\n                <span>Chain {chainId}</span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"flex items-center gap-3\">\r\n          {isConnected && chainId !== 31337 && (\r\n            <button\r\n              onClick={switchToLocalhost}\r\n              className=\"bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm shadow-md\"\r\n              title=\"Switch to Hardhat Local Network\"\r\n            >\r\n               Switch to Local\r\n            </button>\r\n          )}\r\n          <ConnectButton />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Add Log Form */}\r\n      <div className=\"bg-white rounded-xl p-6 shadow-lg border-2 border-purple-200\">\r\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Add Energy Log</h2>\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Date\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                required\r\n                value={form.date}\r\n                onChange={(e) => setForm({ ...form, date: e.target.value })}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Electricity (kWh)\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                required\r\n                min=\"0\"\r\n                value={form.electricity}\r\n                onChange={(e) => setForm({ ...form, electricity: e.target.value })}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                placeholder=\"100\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Gas\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                required\r\n                min=\"0\"\r\n                value={form.gas}\r\n                onChange={(e) => setForm({ ...form, gas: e.target.value })}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                placeholder=\"50\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Water (liters)\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                required\r\n                min=\"0\"\r\n                value={form.water}\r\n                onChange={(e) => setForm({ ...form, water: e.target.value })}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                placeholder=\"200\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading || fhevmStatus !== \"ready\"}\r\n            className=\"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg\"\r\n          >\r\n            {loading\r\n              ? \"Adding...\"\r\n              : fhevmStatus !== \"ready\"\r\n                ? \"Initializing encryption...\"\r\n                : \"Add Energy Log\"}\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      {/* Status Messages */}\r\n      {message && (\r\n        <div\r\n          className={`p-4 rounded-lg ${\r\n            message.includes(\"Failed\") || message.includes(\"Error\")\r\n              ? \"bg-red-100 text-red-700 border border-red-300\"\r\n              : \"bg-green-100 text-green-700 border border-green-300\"\r\n          }`}\r\n        >\r\n          {message}\r\n        </div>\r\n      )}\r\n\r\n      {/* FHEVM Status */}\r\n      <div className=\"bg-white rounded-xl p-4 shadow-lg border-2 border-purple-200\">\r\n        <p className=\"text-sm text-gray-600\">\r\n          FHEVM Status: <span className=\"font-semibold\">{fhevmStatus}</span>\r\n          {fhevmError && (\r\n            <span className=\"text-red-600 ml-2\">Error: {fhevmError.message}</span>\r\n          )}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Logs List */}\r\n      <div className=\"bg-white rounded-xl p-6 shadow-lg border-2 border-purple-200\">\r\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">\r\n          Your Energy Logs ({logs.length})\r\n        </h2>\r\n        {logs.length === 0 ? (\r\n          <p className=\"text-gray-500 text-center py-8\">No logs yet. Add your first energy log above!</p>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {logs.map((log) => (\r\n              <div\r\n                key={log.index}\r\n                className=\"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\"\r\n              >\r\n                <div className=\"flex justify-between items-start\">\r\n                  <div className=\"flex-1\">\r\n                    <h3 className=\"font-semibold text-lg text-gray-800 mb-2\">\r\n                      {log.date}\r\n                    </h3>\r\n                    <div className=\"grid grid-cols-3 gap-4 text-sm\">\r\n                      <div>\r\n                        <span className=\"text-gray-600\">Electricity: </span>\r\n                        <span className=\"font-semibold\">\r\n                          {log.electricity ? `${log.electricity} kWh` : \"***\"}\r\n                        </span>\r\n                      </div>\r\n                      <div>\r\n                        <span className=\"text-gray-600\">Gas: </span>\r\n                        <span className=\"font-semibold\">\r\n                          {log.gas ? `${log.gas}` : \"***\"}\r\n                        </span>\r\n                      </div>\r\n                      <div>\r\n                        <span className=\"text-gray-600\">Water: </span>\r\n                        <span className=\"font-semibold\">\r\n                          {log.water ? `${log.water} L` : \"***\"}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  {log.encrypted && (\r\n                    <button\r\n                      onClick={() => decryptLog(log.index)}\r\n                      disabled={decryptingIndex === log.index || fhevmStatus !== \"ready\"}\r\n                      className=\"ml-4 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                    >\r\n                      {decryptingIndex === log.index ? \"Decrypting...\" : \"Decrypt\"}\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}